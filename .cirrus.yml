test_src_build_macos_task:
  only_if: "changesInclude(
    'libheif/macos/**',
    'libheif/build.py',
    'libheif/public_api.h',
    'setup.*',
    'pyproject.toml')"

  name: Build from source(macOS) / macOS:12-arm64
  macos_instance:
    image: ghcr.io/cirruslabs/macos-monterey-xcode

  script:
    - brew uninstall --force --ignore-dependencies imagemagick
    - brew install --formula ./libheif/macos/libheif.rb
    - python3 -m pip -v install ".[dev]"
    - python3 -c "import pillow_heif; print(pillow_heif.libheif_info())"
    - python3 -m pytest -rs
