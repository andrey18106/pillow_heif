test-src-build-macos:
  only_if: "changesInclude(
    'libheif/macos/**',
    'libheif/build.py',
    'libheif/public_api.h',
    'setup.*',
    'pyproject.toml')"
  brew_prepare:
    brew uninstall --force --ignore-dependencies imagemagick
  brew_install_libheif:
    brew install --formula ./libheif/macos/libheif.rb
  install_pillow_heif:
    python3 -m pip -v install ".[dev]"
  libheif_info:
    python3 -c "import pillow_heif; print(pillow_heif.libheif_info())"
  perform_tests:
    python3 -m pytest -rs
